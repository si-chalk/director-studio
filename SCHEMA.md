# JSON Schema Documentation

## Overview

The storyboard JSON schema defines the complete structure for video storyboards generated by the LLM. Version 1.0 uses `duration_ms` (milliseconds) for shot durations.

## Full Schema

```json
{
  "version": "1.0",
  "generated_at": "2025-10-28T12:00:00.000Z",
  
  "input": {
    "user_prompt": "string",
    "style_filter": ["string"],
    "duration_seconds": 60
  },
  
  "styleSettings": {
    "camera_type": "string (optional)",
    "lighting_style": "string (optional)",
    "colour_palette": "string (optional)",
    "render_style": "string (optional)",
    "aspect_ratio": "string (optional)",
    "notes": "string (optional)"
  },
  
  "characterRegistry": [{
    "id": "string (lowercase_underscore)",
    "name": "string",
    "description": "string",
    "appearance": "string (optional)",
    "wardrobe": "string (optional)",
    "age_range": "string (optional)",
    "tags": ["string"] (optional)
  }],
  
  "objectRegistry": [{
    "id": "string (lowercase_underscore)",
    "name": "string",
    "description": "string",
    "visual_traits": "string (optional)",
    "tags": ["string"] (optional)
  }],
  
  "environmentRegistry": [{
    "id": "string (lowercase_underscore)",
    "name": "string",
    "description": "string",
    "visual_details": "string (optional)",
    "lighting": "string (optional)",
    "tags": ["string"] (optional)
  }],
  
  "scenes": [{
    "scene_id": "string (lowercase_underscore)",
    "title": "string",
    "description": "string",
    "visual_prompt": "string",
    "time_range": {
      "start_s": 0,
      "end_s": 10
    },
    "shots": [{
      "shot_id": "string (lowercase_underscore)",
      "shot_number": 1,
      "shot_type": "enum (see below)",
      "description": "string",
      "visual_prompt": "string",
      "thumbnail_prompt": "string",
      "duration_ms": 3000,
      "characters": ["character_id"],
      "objects": ["object_id"],
      "environment_id": "environment_id (optional)"
    }]
  }]
}
```

## Field Definitions

### Root Level

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `version` | string | ✅ | Schema version (currently "1.0") |
| `generated_at` | string (ISO8601) | ✅ | Timestamp of generation |
| `input` | object | ✅ | Original user inputs |
| `styleSettings` | object | ✅ | Global visual style settings |
| `characterRegistry` | array | ✅ | Character definitions (can be empty []) |
| `objectRegistry` | array | ✅ | Object definitions (can be empty []) |
| `environmentRegistry` | array | ✅ | Location definitions (can be empty []) |
| `scenes` | array | ✅ | Scene breakdown (minimum 1) |

### Shot Object

| Field | Type | Required | Description | Example |
|-------|------|----------|-------------|---------|
| `shot_id` | string | ✅ | Unique ID (lowercase_underscore) | `"shot_1"` |
| `shot_number` | integer | ✅ | Sequential number (1-based) | `1` |
| `shot_type` | enum | ✅ | One of 15 shot types (see below) | `"Close Up"` |
| `description` | string | ✅ | What happens in the shot | `"Chef places dish in oven"` |
| `visual_prompt` | string | ✅ | Detailed visual description | `"Warm kitchen, chef wearing apron..."` |
| `thumbnail_prompt` | string | ✅ | Concise image generation prompt | `"Hands placing dish in oven, warm lighting"` |
| `duration_ms` | integer | ✅ | Duration in milliseconds | `3000` (= 3 seconds) |
| `characters` | array | ❌ | Character IDs in this shot | `["chef_alex"]` |
| `objects` | array | ❌ | Object IDs in this shot | `["creme_brulee"]` |
| `environment_id` | string | ❌ | Environment ID (if applicable) | `"kitchen"` |

### Shot Types (Enum)

```
"Close Up"
"Extreme Close Up"
"Medium Shot"
"Medium Close Up"
"Wide Shot"
"Extreme Wide"
"Insert"
"Overhead"
"POV"
"Tracking"
"Push In"
"Pull Out"
"Tilt"
"Pan"
"Static"
```

## Registry Patterns

### Character Registry

**Purpose**: Maintain consistent character appearance

**Example**:
```json
{
  "id": "chef_alex",
  "name": "Chef Alex",
  "description": "Head chef and restaurant owner",
  "appearance": "Tall, early 40s, salt-and-pepper beard",
  "wardrobe": "White chef's coat with embroidered name",
  "age_range": "40-45",
  "tags": ["protagonist", "expert"]
}
```

**Then reference in shots**:
```json
{
  "shot_id": "shot_3",
  "characters": ["chef_alex"],  // Reference ID, don't redescribe
  ...
}
```

### Object Registry

**Purpose**: Ensure props look identical throughout

**Example**:
```json
{
  "id": "creme_brulee",
  "name": "Crème Brûlée Dish",
  "description": "Classic French dessert in preparation",
  "visual_traits": "Six white porcelain ramekins, caramelized sugar topping, cream custard visible",
  "tags": ["food", "hero-product"]
}
```

### Environment Registry

**Purpose**: Maintain location consistency

**When to use**:
- ✅ Kitchen in cooking video
- ✅ Office in product demo
- ✅ Studio in interview
- ❌ Abstract animation (no location)
- ❌ Surreal dream sequence

**Example**:
```json
{
  "id": "modern_kitchen",
  "name": "Modern Kitchen",
  "description": "Professional home kitchen with marble countertops",
  "visual_details": "White marble counters, stainless steel appliances, pendant lighting, subway tile backsplash",
  "lighting": "Bright natural light from large windows, supplemented by warm pendant lights",
  "tags": ["interior", "daytime"]
}
```

## Duration Guidelines

### Recommended Durations (milliseconds)

| Shot Type | Typical Range | Example |
|-----------|---------------|---------|
| Extreme Close Up | 1000-2000ms | 1500ms |
| Close Up | 2000-4000ms | 3000ms |
| Medium Shot | 3000-6000ms | 4000ms |
| Wide Shot | 4000-8000ms | 6000ms |
| Tracking | 5000-10000ms | 7000ms |
| Static | 2000-5000ms | 3000ms |

### Total Duration Calculation

LLM should ensure shot durations approximately match input duration:

```
Input: duration_seconds = 60 (60 seconds)
Expected: Sum of all duration_ms ≈ 60000ms

Acceptable variance: ±10%
```

## Validation Rules

### ID Format
- Lowercase letters only
- Numbers allowed
- Underscores for spaces
- Hyphens allowed
- Pattern: `^[a-z0-9_-]+$`

Examples:
- ✅ `"shot_1"`
- ✅ `"modern-kitchen"`
- ✅ `"chef_alex_2"`
- ❌ `"Shot 1"` (uppercase, space)
- ❌ `"chefAlex"` (camelCase)

### Required Registries

All three registries MUST exist (can be empty):
```json
{
  "characterRegistry": [],  // OK if empty
  "objectRegistry": [],     // OK if empty
  "environmentRegistry": [] // OK if empty
}
```

### Shot Number Sequence

Shot numbers must be:
- Sequential within each scene
- 1-based (start at 1, not 0)
- No gaps

```json
// ✅ Correct
"shots": [
  { "shot_number": 1 },
  { "shot_number": 2 },
  { "shot_number": 3 }
]

// ❌ Incorrect (gap)
"shots": [
  { "shot_number": 1 },
  { "shot_number": 3 }  // Missing 2
]
```

## Example Complete Storyboard

```json
{
  "version": "1.0",
  "generated_at": "2025-10-28T12:00:00.000Z",
  "input": {
    "user_prompt": "How to make creme brulee",
    "style_filter": ["Cinematic", "Food Photography"],
    "duration_seconds": 30
  },
  "styleSettings": {
    "camera_type": "DSLR with 50mm lens",
    "lighting_style": "Natural window light with fill",
    "colour_palette": "Warm creams, golden caramel, white marble",
    "render_style": "Photorealistic food photography"
  },
  "characterRegistry": [{
    "id": "chef",
    "name": "Chef",
    "description": "Home cook demonstrating recipe",
    "appearance": "Hands visible, white apron",
    "wardrobe": "Clean white apron, rolled sleeves"
  }],
  "objectRegistry": [{
    "id": "ramekins",
    "name": "Ramekin Dishes",
    "description": "Six white porcelain ramekins",
    "visual_traits": "Classic French ceramic, 4oz size, smooth finish"
  }],
  "environmentRegistry": [{
    "id": "kitchen",
    "name": "Modern Kitchen",
    "description": "Bright, clean home kitchen",
    "visual_details": "White marble counters, natural wood cutting board, stainless tools",
    "lighting": "Soft natural light from window, warm tone"
  }],
  "scenes": [{
    "scene_id": "scene_1",
    "title": "Preparation",
    "description": "Chef prepares ingredients and mixes custard",
    "visual_prompt": "Bright modern kitchen, natural lighting, clean aesthetic",
    "shots": [
      {
        "shot_id": "shot_1",
        "shot_number": 1,
        "shot_type": "Wide Shot",
        "description": "Kitchen overview with ingredients laid out on marble counter",
        "visual_prompt": "Modern kitchen, marble counter, eggs, cream, sugar, vanilla arranged artfully",
        "thumbnail_prompt": "Overhead view of baking ingredients on white marble",
        "duration_ms": 3000,
        "objects": ["ramekins"],
        "environment_id": "kitchen"
      },
      {
        "shot_id": "shot_2",
        "shot_number": 2,
        "shot_type": "Close Up",
        "description": "Hands whisking egg yolks with sugar until pale and thick",
        "visual_prompt": "Close-up of bowl, hands whisking, cream mixture turning pale yellow",
        "thumbnail_prompt": "Hands whisking golden egg mixture in glass bowl",
        "duration_ms": 4000,
        "characters": ["chef"],
        "environment_id": "kitchen"
      },
      {
        "shot_id": "shot_3",
        "shot_number": 3,
        "shot_type": "Medium Shot",
        "description": "Pouring custard into ramekins on baking tray",
        "visual_prompt": "Six white ramekins on tray, custard being poured from measuring cup",
        "thumbnail_prompt": "Pouring cream custard into white ramekins",
        "duration_ms": 5000,
        "characters": ["chef"],
        "objects": ["ramekins"],
        "environment_id": "kitchen"
      }
    ]
  }]
}
```

## Version History

### v1.0 (Current)
- `duration_ms` (milliseconds) is REQUIRED
- `environmentRegistry` is REQUIRED (can be empty [])
- `environment_id` is OPTIONAL on shots
- 15 shot types supported

### v0.x (Deprecated)
- Used `duration_s` (seconds, optional)
- No environmentRegistry
- Fewer shot type options

---

**Last Updated**: October 28, 2025
**Schema Version**: 1.0

